<script src="vendor/jsqrcode/grid.js"></script>
<script src="vendor/jsqrcode/version.js"></script>
<script src="vendor/jsqrcode/detector.js"></script>
<script src="vendor/jsqrcode/formatinf.js"></script>
<script src="vendor/jsqrcode/errorlevel.js"></script>
<script src="vendor/jsqrcode/bitmat.js"></script>
<script src="vendor/jsqrcode/datablock.js"></script>
<script src="vendor/jsqrcode/bmparser.js"></script>
<script src="vendor/jsqrcode/datamask.js"></script>
<script src="vendor/jsqrcode/rsdecoder.js"></script>
<script src="vendor/jsqrcode/gf256poly.js"></script>
<script src="vendor/jsqrcode/gf256.js"></script>
<script src="vendor/jsqrcode/decoder.js"></script>
<script src="vendor/jsqrcode/QRCode.js"></script>
<script src="vendor/jsqrcode/findpat.js"></script>
<script src="vendor/jsqrcode/alignpat.js"></script>
<script src="vendor/jsqrcode/databr.js"></script>

<!-- <link rel="stylesheet" href="css/main.css"> -->

<style media="screen">
body, html {
	margin: 0;
	padding: 0;

	/* width: 100%;
	height: 100%;	 */
}

.fullscreen-bg {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    overflow: hidden;
    z-index: -100;
}

.fullscreen-bg__video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}
@media (min-aspect-ratio: 16/9) {
  .fullscreen-bg__video {
    height: 300%;
    top: -100%;
  }
}

@media (max-aspect-ratio: 16/9) {
  .fullscreen-bg__video {
    width: 300%;
    left: -100%;
  }    
}    
</style>

<body>
        <div class="video-container fullscreen-bg">
                <video id="camsource" class='fullscreen-bg__video'></video>
        </div>
        <canvas id="qr-canvas" width="320" height="240" style="display:none"></canvas>

<script>

        qrcode.callback = function read(qrCodeValue){
        	console.log('read value', qrCodeValue)
        };

        //////////////////////////////////////////////////////////////////////////////
        //		Code Separator
        //////////////////////////////////////////////////////////////////////////////
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

        // Assign the <video> element to a variable
        var videoEl = document.querySelector('#camsource');
        var options = {
        	"audio": false,
        	"video": true
        };
        // Replace the source of the video element with the stream from the camera
        console.assert(navigator.getUserMedia, 'navigator.getUserMedia not defeined')
        navigator.getUserMedia(options, function(stream) {
        	videoEl.src = (window.URL && window.URL.createObjectURL(stream)) || stream;
        }, function(error) {
        	console.log(error)
        });

        function scanVideo(){
        	// dont scan if videoEl isnt yet initialized
        	if( videoEl.videoWidth === 0 )	return
        	
        	var scale = 0.5
        	// console.time('capture');
        	var canvasEl = document.querySelector('#qr-canvas')
        	var context = canvasEl.getContext('2d');
        	// resize canvasEl
        	canvasEl.width = videoEl.videoWidth * scale;
        	canvasEl.height = videoEl.videoHeight * scale;

        	context.drawImage(videoEl, 0, 0, canvasEl.width, canvasEl.height);
        	try {
        		qrcode.decode();
        	} catch(error) {
            		console.error(error);
        	}	
        }

        scanVideo()
        setInterval(function() {
        	scanVideo()
        }, 100);
        </script>
</body>
